"use strict";$(function(){var e=cookie.get("uid");function t(n,i){var t=1*n.parent().find("input").val(),e=1*n.parent().parent().prev().html(),a=1*n.parent().parent().prev().prev().find("p").html().slice(1),s=1*n.parent().parent().parent().parent().parent().attr("data-gid");e<=t?(t=e,n.parent().find(".add").addClass("disabled"),n.parent().find(".minus").removeClass("disabled")):t<=i?(t=i,n.parent().find(".minus").addClass("disabled"),n.parent().find(".add").removeClass("disabled")):n.parent().find(".minus,.add").removeClass("disabled");var c=(t*a).toFixed(2);n.parent().find("input").val(t),n.parent().parent().next().find("em").html(c),$.ajax({type:"post",url:"../api/shopcart.php",data:{p:"nowNum",gid:s,num:t,least:i,allPrice:c},success:function(n){var i=JSON.parse(n);i.code,console.log(i.message)}}),l()}function a(n){$.ajax({type:"post",async:!1,url:"../api/shopcart.php",data:{p:"delOne",gid:n,uid:e},success:function(n){var i=JSON.parse(n);i.code?(console.log(i.message),l()):console.log(i.message)}})}$.ajax({type:"post",url:"../api/shopcart.php",data:{p:"cart",uid:e},success:function(n){var i=JSON.parse(n);if(i.code){var t=i.con.map(function(n){var i="";return i=n.num<=n.least?'<span class="num_op minus disabled" title="减少1个数量">\n                                    <i class="iconfont icon-move"></i>\n                                </span> \n                                <input class="nowNum" type="text" value="'+n.num+'">\n                                <span class="num_op add" title="增加1个数量">\n                                    <i class="iconfont icon-add"></i>\n                                </span>':n.num>=n.invon?'<span class="num_op minus" title="减少1个数量">\n                                    <i class="iconfont icon-move"></i>\n                                </span> \n                                <input class="nowNum" type="text" value="'+n.num+'">\n                                <span class="num_op add disabled" title="增加1个数量">\n                                    <i class="iconfont icon-add"></i>\n                                </span>':'<span class="num_op minus" title="减少1个数量">\n                                    <i class="iconfont icon-move"></i>\n                                </span> \n                                <input class="nowNum" type="text" value="'+n.num+'">\n                                <span class="num_op add" title="增加1个数量">\n                                    <i class="iconfont icon-add"></i>\n                                </span>','<div class="item_list_bd">\n                                <div class="item_body cle" data-gid="'+n.gid+'">\n                                    <div class="item_info cle">\n                                        <div class="pic"> <a href="javascript:;" target="_blank"> <img\n                                                    src="'+n.image+'">\n                                            </a> </div>\n                                        <div class="bd">\n                                            <div class="title"> <a href="javascript:;" target="_blank">'+n.name+'</a> </div>\n                                            <div class="sales"> <span>已售'+n.volume+"件</span> <span>起批量≥<em>"+n.least+'</em>件</span> </div>\n                                        </div>\n                                    </div>\n                                    <div class="item_sku">\n                                        <ul id="sku_" class="cle" >\n                                            <li class="spec">\n                                                <p>'+n.speci+'</p>\n                                                <p class="gray">条码：'+n.bar+'</p>\n                                            </li>\n                                            <li class="price">\n                                                <p class="sku_price">￥'+n.price+'</p>\n                                            </li>\n                                            <li class="storage"> '+n.invon+' </li>\n                                            <li class="num">\n                                                <div class="skunum">\n                                                    '+i+'\n                                                </div>\n                                            </li>\n                                            <li class="sum">\n                                                <p class="price_sum"> ￥<em>'+n.allPrice+'</em> </p>\n                                            </li>\n                                            <li class="move"><a href="javascript:;">删除</a></li>\n                                            <li class="op"> <input class="check" type="checkbox"> </li>\n                                        </ul>\n                                    </div>\n                                </div>\n                            </div>'}).join("");$(".item_list").html(t)}else $("#content").html('<a class="conlist" style="cursor:pointer">购物车里还没有东西哦,点击前往购买</a>').css({color:"red","font-size":20,"text-align":"center","line-height":"50px","min-height":100})}}),$("#content").on("click",".conlist",function(){location.href="list.html"}),$(".item_list").on("click",".add",function(){var n=1*$(this).prev().val(),i=1*$(this).parent().parent().parent().parent().prev().find(".sales em").html();n++,$(this).prev().val(n),t($(this),i)}),$(".item_list").on("click",".minus",function(){var n=1*$(this).next().val(),i=1*$(this).parent().parent().parent().parent().prev().find(".sales em").html();n--,$(this).next().val(n),t($(this),i)}),$(".item_list").on("blur",".nowNum",function(){var n=1*$(this).parent().parent().parent().parent().prev().find(".sales em").html(),i=1*$(this).val();$(this).val(i),t($(this),n)}),$(".item_list").on("click",".move",function(){confirm("您确定要删除吗？")&&($(this).parent().parent().parent().parent().remove(),a(1*$(this).parent().parent().parent().attr("data-gid")))}),$(".quickbuy_list").on("click",".allCheck",function(){var n=$(this).parent().parent().prev().find(".check");$(this).prop("checked")?n.prop("checked",!0):n.prop("checked",!1),l()});var s=[];function l(){s=[],$(".item_list .check").each(function(n,i){$(".item_list .check").eq(n).prop("checked")&&s.push(n)}),s.length==$(".item_list .check").size()?$(".allCheck").prop("checked",!0):$(".allCheck").prop("checked",!1);for(var n=0,i=0,t=0;t<s.length;t++)n+=1*$(".item_list .nowNum").eq(s[t]).val(),i+=1*$(".item_list .price_sum em").eq(s[t]).html();$(".cartPrice .nowNum em").html(n.toFixed(0)),$(".cartPrice .nowPrice em").html(i.toFixed(2)),$(".item_list").html()||$("#content").html('<a class="conlist" style="cursor:pointer">购物车里还没有东西哦,点击前往购买</a>').css({color:"red","font-size":20,"text-align":"center","line-height":"50px","min-height":100}),$.ajax({type:"post",url:"../api/shopcart.php",data:{p:"cart",uid:e},success:function(n){var i=JSON.parse(n);if(i.code){var t=0;i.con.map(function(n){t+=1*n.num,$("#sidebar_cartnum,.cartnum").html(t).css({visibility:"visible",opacity:1,transform:"scale(1)"})})}else $("#sidebar_cartnum,.cartnum").html(0).css({visibility:"visible",opacity:1,transform:"scale(1)"})}})}$(".item_list").on("click",".check",function(){l()}),$(".moveAll").on("click",function(){if(confirm("您确定要删除吗？"))for(var n=s.length-1;0<=n;n--){var i=1*$(".item_body").eq(s[n]).attr("data-gid");$(".item_list_bd").eq(s[n]).remove(),a(i)}}),$(".item_list").on("click",".pic",function(){var n=$.trim($(this).next().find(".title a").html());location.href="goods.html?"+n}),$(".item_list").on("click",".title a",function(){location.href="goods.html?"+$.trim($(this).html())})});